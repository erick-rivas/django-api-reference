# Django Reference

This repository holds the source code of a **reference** for the development of a **Django api** written mainly in python.

## Table of content

-   [Overview](#overview)
-   [Pre-requisites](#pre-requisites)
-   [Installation](#installation)
    -   [Run project](#run-project)
    -   [Filling of database](#filling-of-database)
    -   [Test running](#test-running)
-   [Examples](#examples)
-   [Seed-Builder](#seed-builder)
    -   [Extend modules](#extend-modules)
-   [Deployment](#deployment)
    
## Overview

The reference uses a architecture based on a Generic Model View pattern, Inspired by the architecture of [Django framework](https://www.djangoproject.com), [Django REST framework](https://www.django-rest-framework.org) and [Graphene-Django](https://docs.graphene-python.org/projects/django/en/latest/).

In general terms, the architecture uses the following structure:

-   /app: General settings of the applications.
    -   settings.py: Django settings (Eg. installed modules, global vars, etc).
-   **/domain**: Business logic methods. [More info](./domain/README.md)
-   **/views**: Api routes extensions (Custom endpoints definitions). [More info](./views/README.md).
-   **/fixtures**: Initial data inserts (Eg. dummy data and catalogs). [More info](https://docs.djangoproject.com/en/3.1/howto/initial-data/)
-   /models: Model extensions. [More info](./models/README.md)
-   /seed: Autogenerated files produced by seed-builder: It includes model definitions, CRUD endpoint creation, serializers and graphql implementation
 > These files are *read-only*, modifiable only through seed-builder [More info](#seed-builder)

## Pre-requisites

-   Download & install [Python3](https://www.python.org/downloads/).
-   Download & install [Postgresql](https://www.postgresqltutorial.com/postgresql-getting-started/).
-   Download & install [PyCharm CE](https://www.jetbrains.com/pycharm/download/) (optional).

## Installation

-   Clone this repository.
-   Create & activate a virtual environment
```bash
python3 -m venv .venv
. .venv/bin/activate
```
>   For windows, activate with . .venv/Script/activate

-  Install dependencies
```bash
pip3 install -r requirements.txt
```

-   Create a new postgresql database.
-   Copy .env.example and paste it renaming to .env.dev (development environment) or .env.prod (production environment)
-   Configure .env.* fields with server attributes, database connections, secret keys, etc.

-   Make database migrations.
```bash
python3 manage.py makemigrations
```

-   Execute migrations.
```bash
python3 manage.py migrate
```

-   Run project.
```bash
python3 manage.py runserver
```

### Filling of database 

-   Load fixtures (initial data).
```bash
python3 manage.py loaddata fixtures/*.yaml
```
>  Note for windows run one by one or check automation script in fixture folder (eg. run-fixtures.sh)

## Examples

-   Execute api request.
```bash
GET http://localhost:8000/api/players
```

-   Open graphql debugger.
```bash
GET http://localhost:8000/graphql
```

-   Open admin pane.
```bash
http://localhost:8000/admin
```
>   To access admin pane, create a user fixture with *is_superuser* attribute set to true 

## Seed-Builder

> Seed-builder is a code generator library to facilitate the creation and management of *boilerplate code* required by the application such as model & serializer definitions, CRUD endpoint creation and graphql implementation. 

To create or update seed-builder autogenerated files

-   Install [StarUML](http://staruml.io/download) & seed-extension ([https://github.com/erick-rivas/seed-staruml](https://github.com/erick-rivas/seed-staruml))
-   Open model definition file (*SeedModeling.mdj*) and modify the diagram with the rules defined in [seed-extension README](https://github.com/erick-rivas/seed-staruml/blob/master/README.md)
-   Export diagram and override SeedManifest.json
-   Install seed-builder cli
```bash
npm install -g seed-builder
```
-   Run builder
```bash
seed-builder
``` 
> It automatically detect the project settings described in SeedManifest.json and update or create the required files

### Extend modules

In case of extend the functionality of autogenerated resources (Eg. Add a custom endpoint, edit a model str() method, etc). Use *seed-builder extend* command, Examples

-   Extend the a model
```bash
seed-builder extend -m model:<model_name>
``` 

-   Extend the a view
```bash
seed-builder extend -m view:<model_name>
``` 

>   When extend a module a new file is generated in the module folder (Eg. models/)

## Deployment

### AWS - Elastic Beanstalk

To deploy application to aws-eb see [deployment](./bin/aws-eb/deployment.md).

### Ubuntu Server (Debian)

To deploy application to a Ubuntu Server (Debian) see [deployment](./bin/ubuntu/deployment.md).