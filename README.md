# Django Reference

This repository holds the source code of a **reference** for the development of a **Django api** written mainly in python.

## Table of content

-   [Overview](#overview)
-   [Pre-requisites](#pre-requisites)
-   [Installation](#installation)
    -   [Run project](#run-project)
    -   [Filling of database](#filling-of-database)
    -   [Test running](#test-running)
-   [Examples](#examples)
-   [Builder](#builder)
-   [Deployment](#deployment)
    
## Overview

The reference uses a architecture based on a Generic Model View pattern, Inspired by the architecture of [Django framework](https://www.djangoproject.com), [Django REST framework](https://www.django-rest-framework.org) and [Graphene-Django](https://docs.graphene-python.org/projects/django/en/latest/).

In general terms, the architecture uses the following structure:

-   /app: General settings of app.
    -   api.py: Api additional routes.
    -   settings.py: App settings (dependencies, configurations, etc).
-   /domain: Business logic methods. [More info](./domain/_guides.md)
-   /fixtures: Initial data inserts (Eg. dummy data and catalogs).
-   /models: Model definitions. [More info](./models/_guides.md)
-   /seed: Autogenerated files (builder).
-   /views: Api route definitions. [More info](./views/_guides.md).

## Pre-requisites

-   Download & install [Python3](https://www.python.org/downloads/).
-   Download & install [PyCharm CE](https://www.jetbrains.com/pycharm/download/).

## Installation

-   Clone this repository.
-   Install postgresql and create a database.
-   Create & activate virtual environment
```bash
python3 -m venv .venv
. .venv/bin/activate
```
>   For windows, activate with . .venv/Script/activate

-  Install dependencies
```bash
pip3 install -r requirements.txt
```
-   Copy .env.example and rename to .env.dev (development settings) or .env.prod (production settings)
-   Configure .env.*  attributes.
-   Make migrations.
```bash
python3 manage.py makemigrations
```

-   Run migrations.
```bash
python3 manage.py migrate
```

### Run project

-   Activate virtual environment
```bash
. .venv/bin/activate
```
>   For windows, run . .venv/Script/activate
-   Run project.
```bash
python3 manage.py runserver
```

### Filling of database 

-   Load fixtures (initial data).
```bash
python3 manage.py loaddata fixtures/*.yaml
```
>  Note for windows run one by one or check automation script in fixture folder (ex run-fixtures.sh)

## Examples

-   Execute api request.
```bash
GET http://localhost:8000/api/players
```

-   Execute graphql request.
```bash
GET http://localhost:8000/graphql
```

-   Open admin pane.
```bash
http://localhost:8000/admin
```
>   To access admin pane, create a user fixture with *is_superuser* attribute set to true 

## Builder

To update data models and autogenerated files

-   Install staruml & [seed-extension](https://github.com/erick-rivas/seed-staruml)
-   Open model-definition file (.mdj)
-   Export diagram and override SeedManifest.json
-   Install seed-builder cli
```bash
npm install -g seed-builder
```
-   Update models
```bash
seed-builder
``` 

## Deployment

### AWS - Elastic Beanstalk

To deploy application to aws-eb see [deployment](./bin/aws-eb/deployment.md).

### Ubuntu Server (Debian)

To deploy application to a Ubuntu Server (Debian) see [deployment](./bin/ubuntu/deployment.md).